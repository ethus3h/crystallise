#!/usr/bin/env bash
# shellcheck disable=SC1091
source ember_bash_setup &> /dev/null

((EUID)) && exec sudo -- "$0" "$@"
trap 'die "A fatal error was reported on ${BASH_SOURCE[0]} line ${LINENO}."' ERR
#set -x

action="$1"
mountpoint="$(crystallize-getconf SfrsMountpoint)"

case $action in
mount)
    mkdir -p "$mountpoint"
    root="$(crystallize-getconf EmberLibrary)"
    sreg_fuse.py "$root" "$mountpoint"
    ;;
unmount)
    umount "$mountpoint"
    ;;
*)
    echo "Unknown action."
    exit 1
    ;;
esac
